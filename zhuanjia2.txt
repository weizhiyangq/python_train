




硕 士 学 位 论 文


基于物联网的荔枝园信息获取与
专家决策系统


余 国 雄





中国・广州
2017年6月
华南农业大学
学位论文原创性声明
本人郑重声明：所呈交的学位论文是本人在导师的指导下独立进行研究所取得的研究成果。除了文中特别加以标注引用的内容外，本论文不包含任何其他个人或集体已经发表或撰写的作品成果。对本文的研究做出重要贡献的个人和集体，均已在文中以明确方式标明。本人完全意识到本声明的法律结果由本人承担。
作者签名：                       日期：                   

学位论文版权使用授权书
本学位论文作者完全了解学校有关保留、使用学位论文的规定，即：研究生在校攻读学位期间论文工作的知识产权单位属华南农业大学。学校有权保存并向国家有关部门或机构送交论文的复印件和电子版，允许学位论文被查阅或在校园网上发布并供校内师生和与学校有共享协议的单位浏览（除在保密期内的涉密论文外）；学校可以公布学位论文的全部或部分内容，可以允许采用影印、缩印或其它复制手段保存、汇编学位论文。本人电子文档的内容和纸质论文的内容相一致。
作者签名：                       日期：                   
导师签名：                       日期：                   

学位论文提交同意书
本学位论文符合国家和华南农业大学关于研究生学位论文的相关规定，达到学位授予要求，同意提交。
导师签名：                        日期：                   
学科带头人签名：                  日期：                   

摘    要
中国是荔枝种植大国，1987年我国的荔枝栽培面积为12.75万hm2，2015年其面积已经达到55.33万hm2；1987年荔枝总产量为11.68万t，2015年其产量已经达到220万t。目前我国绝大多数荔枝园依然采用传统的人工方式去管理，果树的灌溉、果树的施肥、病虫害预测与防治等均要靠人为经验判断并做出决策。这种人工管理方式比较粗犷，目的性不强，特别是采用漫灌等传统的灌溉方式，导致严重的水资源浪费。
物联网技术的出现为实现果园现代化管理提供了强有力的支持，将物联网技术应用在果园生产与管理上，可以实现远程监测果园的实时环境信息，定时适量地向果树供给水分和肥料，减少水资源消耗；通过物联网技术，管理者可以迅速得知是否会发生病虫害，并做出预防或者治疗措施，以提高果实产量和质量。
本文将荔枝作为应用对象，构建基于物联网的荔枝园信息获取与专家决策系统，分别设计了信息获取软硬件与专家决策系统，并在实际荔枝园中进行了系统试验。本文主要研究内容和成果如下：
系统介绍物联网技术的发展和作用，详细分析专家开发的关键技术，为构建基于物联网的荔枝园信息获取和专家决策系统提供理论基础；
从环境数据采集、网络拓扑结构、采集数据频率、网关模块及远程服务器设计和精确的决策模型设计等五个方面详细分析系统功能需求，介绍系统总体架构，并说明其工作流程；
研究设计系统的信息获取部分，包括硬件设计和软件编程，为专家决策系统决策提供了数据支持；硬件设计主要是设计终端监控设备和网关模块，其中，终端监控设备设计包括短距离无线通信模块选型、处理器选型、设计信息采集终端模块、设计终端控制模块和设计路由模块；软件设计主要是3个部分，首先是终端监控设备软件设计，包括组网方式、设计信息采集终端模块软件、设计终端控制软件和设计路由模块软件等；接着是设计网关模块软件，最后是设计远程服务器模块软件，包括工作原理、数据通信协议、数据交互方式和功能设计和实现等。
专家决策系统设计主要包括设计专家决策系统的数据库，包括综合数据库和知识库；设计专家系统的施肥和病虫害决策规则、对荔枝病害和虫害分别进行归纳和分类，并通过软件编程实现专家系统的各个功能模块，使得专家系统可以接收信息获取部分采集的荔枝园实时环境信息数据，并结合部分辅助事实，作出智能决策。
设计详细的试验方案，在荔枝园实际环境中对系统的工作性能进行了多个试验，包括网络丢包率试验、信息采集终端模块精度测试、专家系统灌溉决策准确性测试和专家系统决策实时性测试，汇总并分析试验数据，总结试验结论：网络丢包率试验表明，系统的平均丢包率为3.41%，表明系统能稳定运行，信号能可靠传输；信息采集终端模块精度测试表明，该模块具有较高的监测精度，能为专家系统决策提供比较准确的数据支持；专家系统灌溉决策准确性测试表明，相对于输入量为单参数的情况，专家系统决策输入量为多参数时，灌溉决策的准确性更高；专家系统决策实时性测试表明，灌溉区内荔枝树的土壤含水率始终处于荔枝树生长的最佳含水率范围内，即15.55 %～19.14 %，专家系统决策实时性较强，反应速度快。

关键词：物联网；专家系统；决策；信息获取；荔枝园 


























Information acquisition and expert decision system in litchi orchard based on internet of things
Yu Guoxiong
(College of Electronic Engineering, South China Agricultural University, Guangzhou 510642, China)
Abstract: China is the great country of planting litchi. Chinese litchi cultivation area was 127.5 thousand hm2 in 1987’s, but it had been 553.3 thousand hm2 in 2015; The total output of litchi was 116.8 thousand t in 1987, but it had been 2200 thousand t in 2015. A majority of the litchi orchards are still arranged with traditional artificial way in our country, like irrigation and fertilization of fruit trees, predicting pest diseases and so on are depending on artificial experience to make a decision. This kind of artificial management is so rough and less purpose, especially the traditional irrigation methods such as flooding, which cause a waste of water resources.
The emergence of the Internet of things has provided strong support for the realization of orchard modernization. The application of internet of things in orchard production and management can realize the remote monitoring orchard real-time environmental information, otherwise, timely supply of water and fertilizer to fruit trees to minimize the consumption of water resources. Through the internet of things, managers can know the occurrence of pest diseases in time, in order to make preventive or treatment measures, which can greatly improve the fruit yield and quality.
Considering litchi as an application object, this paper constructs the litchi orchard information acquisition and expert decision-making system based on the Internet of things, designing the system software, hardware, research and establishing multiple expert decision-making models, carring out system test in the actual litchi orchard environment as well. The main contents and achievements of this paper are as follows:
Introduce the development of Internet technology and function systematicly, investigate the irrigation decision theory model of expert system, analyze the key technologies developed by experts in detail, theremore, provide theoretical basis for the construction of litchi orchard information acquisition and expert decision system, which are basing on the internet of things.
Analyze the system function needs on environmental data acquisition, network topology structure, data frequency acquisition, module and remote server design and precise decision model design in detail. Introduce the overall architecture and functions of the system. And explain the workflow of the system.
Investigate the information acquisition part of design system including hardware design and software programming, as a result, provide data support for the decision model of expert system. Hardware design mainly designs terminal monitoring equipment and gateway module. Especially, the design of terminal monitoring equipment includes the selection of short-distance wireless communication module, processor selection, information acquisition terminal module design, terminal control module design and routing module design. Software design is mainly three parts, first of all is the design of terminal monitoring equipment software including network mode, information acquisition terminal module software design, terminal control software design and routing module software design, etc. Then the gateway module software is designed. Finally the remote server module software is designed including working principle, data communication protocol, data interaction, function design and implementation and so on.
The design of intelligent irrigation expert decision system mainly includes the database of design expert decision system including integrated databases and knowledge base. Designing expert system of fertilization and plant diseases and insect pests of decision rules, the litchi diseases and insect pests were summarized and classified, realizing every function module of expert system by software programming, Which make expert system receives real-time environmental information data of litchi orchard from information acquisition section and make intelligent decision combiling partial auxiliary facts.
This paper designed the detailed testing program to test the working performance of the system in the litchi orchard, the real environment, including the test of the internet packet loss rate, the accuracy of information collecting terminal module and the irrigation decision of expert system, the decision real-time performance of expert system. Then summarize and analyze the testing data. Finally draw the testing conclusion. The test of the internet packet loss rate shows that the average packet loss rate of the total system is about 3.41%, which means that the system can work stably and the internet transmission of the system is steady and reliable. The test of information collecting terminal module accuracy indicates that the monitoring precision of the module is high enough to offer accurate decision data support for expert decision system. The test of the irrigation decision of expert system accuracy shows the irrigation decision accuracy is higher, when the expert system input is multiparameter rather than one-parameter. The test of the decision real-time performance of expert system indicates the soil moisture content of litchi trees in irrigation area is between 15.55% and 19.14%, which keeps the trees in a most suitable growing situation. As a result, the decision real-time performance of expert system is excellent and its reaction speed is quick. 

Key words: internet of things; expert system; decision-making; information-obtaining; litchi orchard

目    录














































































第1章 绪论
1.1 研究背景及意义
1.1.1 研究背景
（1）荔枝种植现状
中国是荔枝产业大国，种植的荔枝品种非常丰富多样，其中已经超过30个品种达到了商业化水平（陈厚彬，2010）。生产地较为集中，主要在两广、云南和海南等地方。从1980年至今，我国荔枝的种植面积和总产量都在逐年增加（庞新华，等，2014）。近年来，我国的荔枝种植面积一般能达到55.33万hm2（余华荣，等，2016）。荔枝产量虽受气候条件的影响而出现波动，但是仍然保持着高产量，从2013年的180万t ，增加到了2015年220万t（齐文娥，等，2016）。
目前我国绝大多数荔枝园仍然采用传统的人工方式去管理，果树的灌溉、果树的施肥、病虫害预测与防治等均要靠人为判断并做出决策（陈其林，2010）。这种人工管理的方式比较粗犷，目的性不强，特别是采用漫灌等传统的灌溉方式，造成了严重的水资源浪费（张承林，2010）。因此，需要一种系统实现自动监测荔枝园环境信息并做出专家决策，辅助果农科学地管理荔枝园。 
（2）物联网技术
麻省理工学院的Ashton教授在1999年提出了物联网的概念（秦怀斌，等，2014）。美国在2009年将物联网技术列为国家的发展战略之一（Song，et al，2013）；同年8月，中国总理温家宝提出了“感知中国”的想法（梅方权，2009）。物联网作为新兴产业，2010年时已经是中国重点发展的对象（万爱华，2014）。
物联网技术是在传感器技术上融入了互联网的新技术，可以实现对事物的自动识别、监测和智能管理（时雷，2013）。从技术上看，物联网体系分为3层，包括感知层、传输层和应用层。感知层是指利用传感器技术和射频技术等手段，监测对象的实时状况和环境等数据（张瑞瑞，等，2009）。传输层用于信息传输，包含Zigbee网和GPRS网等多种通信协议，可以将感知层的数据传输到应用层上。应用层对接收到的数据进行保存和分析，做出智能决策，实现科学管理。
（3）专家系统
	1956年人工智能的诞生，为专家系统的产生拉开了序幕（Joseph Giarratano，et al，2005）。专家系统是集成了人类专家知识和经验，能模拟专家思考问题并给出解决方案的计算机系统（姚向华，等，2012）。专家系统主要包括6个部分，分别为综合数据库、知识库、推理机、知识获取、解释器和人机交互界面（蔡自兴，等，2005）。
	专家系统的应用领域相当广泛，包括军事、科研和商业等领域（Zhan Jiafang，et al，2011）。20世纪70年代末，专家系统开始应用于农业方面（黄朝圣，等，2013）。果园专家系统是农业专家系统中比较重要的部分，具备节水灌概、病虫害预测与防治、专家答疑等功能。
为了节约水资源，提高其利用率，实现精确灌溉，需要在专家系统上建立多个不同功能的灌溉决策模型，这些模型的决策因素来自于两个部分，包括系统自动获取的空气温度、空气湿度、土壤含水率和降水量等农作物生长环境的实时信息数据和农民通过人机交互界面输入的其他数据。
专家决策系统数据库中存储着多种荔枝病虫害的特征，用户选择相应的特征后，专家系统能判断出该病害或虫害的名称，辅助用户更科学地预防病虫害。
1.1.2 研究意义
传统的荔枝园管理方式有着比较多的不足之处：荔枝树的生长状况靠人为判断，存在着比较大的误差；应对措施的实施往往存在着较大的延时性；采用漫灌等方式，导致严重的水资源浪费。
本课题针对以上人工管理方式存在的问题，研究设计了“基于物联网的荔枝园信息获取与专家决策系统”，研究内容分为信息获取部分和专家决策系统。其中，信息获取部分利用物联网技术，将信息采集终端模块采集的空气温度、空气湿度、土壤含水率和光照度等荔枝园实时环境信息，通过Zigbee网传输到网关模块上；网关模块通过GPRS网将数据包传输到远程服务器模块上并保存到数据库中，供专家决策系统调用。同时，终端控制模块通过网关模块能接受来自专家决策系统的决策命令，操控电磁阀开闭，实现智能灌溉。专家决策系统具有灌溉预测与决策、诊断荔枝病虫害，专家答疑和系统管理等功能，将荔枝园实时环境数据和用户输入的辅助信息进行综合分析和处理后，得出决策结果。该系统能帮助果农更迅速更准确地掌握和荔枝树的生长概括和荔枝园的实时情况，并根据果农管理要求的不同，做出对应的决策，改善了灌溉方式，对于水资源利用率的提高，增加荔枝的产量和质量有着十分重要的意义。
1.2 物联网在果园中应用的研究进展
自物联网技术被提出以来，研究者逐渐将其与农业应用结合起来，主要体现为将信息化、自动化与传统农业融合（Morais，et al，2008；Pardossi，et al，2009），形成现代化农业。
由于果园中的空气温度、湿度、土壤含水率和病虫害等环境因素都会对果树的生长产生影响，进而影响到果实的质量和产量（邓小蕾，2014）。如何对果园环境进行实时监测和及时自动做出有效措施，成为确保果树健康生产，果实产量稳定的关键问题。
将物联网技术应用在果园生产与管理上，可以实现远程监测果园的实时环境信息（李瑾，等，2015），定时适量地向果树供给水分和肥料，将水资源的消耗减少到最低；通过物联网技术，管理者能第一时间得知病虫害的发生，并及时做出预防或者治疗措施，能大大提高果实产量和质量（费玉杰，等，2013）。因此，物联网技术的出现为实现果园现代化管理提供了强有力的支持，并在实际的果园应用中取得了较为突出的成果。
1.2.1 国外研究进展
物联网技术在国外较早地起步，发展速度也非常快，因此出现了很多物联网技术在果园中的应用成果（Hwang，et al，2010；Nikhil Jorapur，et al，2015）。
2002年英特尔公司结合物联网技术，在俄勒冈州建立起全球首个采用无线监测技术的葡萄园。传感器节点遍布在该葡萄园的每处地方，这些节点以60秒为一个周期监测葡萄园里的环境信息，例如土壤水分含水率、土壤温度和该地方的害虫数量等，实现对葡萄园的科学管理，从而达到葡萄高产的目的（杨凯盛，2011）。
Mancuso 等（2006）通过Sensicast公司生产的RTD204无线通信模块，远程采集温室中的西红柿生长环境信息，如空气温度、空气湿度、土壤含水率和土壤温度等，实现了温室西红柿自动化和智能化生产管理。
Lpez Riquelme等（2009）研发了一套处于试验阶段的无线传感器网络系统，并将该系统安装在一个位于木尔西亚半干旱地区的负责生态园艺的企业里。实时监测生态园的空气温度、空气湿度、土壤含水率和土壤温度等环境信息，达到无线管理目的。
Emanuel等（2011）针对应用在葡萄园里的利用太阳能作为电源的智能网关，专门设计了该网关的软硬件，提高了网关的适应性，使得整套监测系统更加稳定地运行。
Maione等（2013）等设计了一套针对苹果种植的无线监测系统，通过多达27个土壤温度传感器和135个土壤水分传感器，定时检测苹果园的土壤水分含水率和土壤温度的变化，将环境数据传送到远程的综合管理平台，提高了苹果的质量和产量。
1.2.2 国内研究进展
在国内，物联网技术在果园中的应用研究开展的比较晚，但重视程度正在提高（宋立伟，2011；阎晓军，等，2012）。专家们针对我国的具体环境，逐渐地开发出适合我国的特定环境远程监控系统，并且都取得了不错的成效。
彭燕等（2009）设计了一套远程监测果园实时环境信息的方案，该方案的提出，有效改善了我国果园生产管理水平低下的状况。
樊志平等（2010）以柑橘为应用对象，研究设计了基于ZigBee的柑橘园远程智能监控系统。该系统的传感器节点利用ECH2O土壤水分传感器定时采集柑橘园的土壤湿度，通过Zigbee网传输到搭载ARM9处理器的网关上，网关通过互联网将数据传输到远程管理平台上，通过管理平台分析数据并做出实时控制措施。
王卫星等（2011）针对茶园的实际环境状况，研发了一套适用于茶园的信息采集与管理系统。该系统的传感器节点能定时监测空气温度、空气湿度和土壤含水率等茶园环境信息，通过独立编写的通信协议进行数据传输，还以此专门编写了应用程序和后台管理软件。
谢家兴等（2015）研究设计的荔枝园灌溉系统，达到智能节水效果。系统中的传感器节点采集的荔枝园环境的实时信息，通过Zigbee网和互联网发送到远程服务器上，保存到数据库中，网站模块可以综合分析数据，当土壤含水率超过了预设的阈值时，会发送相应的命令控制相应的电磁阀节点进行工作，即开启或关闭电磁阀，使得荔枝园的土壤湿度始终在适合荔枝生长的范围内。 
赵文星等（2016）针对果园环境非常复杂的情况，设计了能采集多个环境信息的物联网果园环境监测系统，并且通过不同的图和表将多个环境信息数据表示给用户查看，非常直观地显示出果园环境的实时变化状况。
王玺等（2016）为了提高果园里水资源的利用率，研究设计了果园智能灌溉系统，该系统可以将传感器模块监测的实时果园环境信息，如风速、空气温度、空气湿度和土壤含水率等，作为相关参数计算出灌溉时间和灌溉量，实现了精确灌溉。
但以上系统均没有建立相关的决策模型，比如没有灌溉预报与决策模型，灌溉决策模型，使系统缺乏精确性。
1.3 农业专家系统的研究进展
现代果园生产管理中，以实现精准管理，提高作物的产量和质量为目的，果园专家系统的出现，使得这一问题迎刃而解（陈维榕，等，2016）。果园专家系统能自动获取农作物生长环境的实时信息数据，包括空气温度、空气湿度、土壤含水率和降水量等（Mare Srbinovska，et al，2015），将这些参数导入灌溉决策模型中，同时，通过人机交互界面接收用户输入的其他信息，根据用户不同的要求做出相应的智能决策，实现了精确灌溉。
1.3.1 国外研究进展
20世纪70年代末，国外研究者开始将专家决策系统应用在农业上（Alexandros Kaloxylosa et al，2012），提高了农作物的产量和质量，节约了水资源，也提高了农民的收益，推动了现代农业的发展。
Heinemann 等（2002）选择GIS作为灌溉区域信息管理平台，利用决策支持开发工具DSSAT，建立了作物空间需水模型，该模型充分考虑需水量、土壤含水量、气候因素等的影响，提高了决策结果的精确性。
Plant等（2008）开发了一套棉花生产管理专家系统，该系统使用了多达15种方法来确定棉花的蒸发量、灌溉时间间隔和灌水量，但该系统是基于专家系统外壳CLARE而开发的，导致系统中的数据不能通过互联网传输到远程管理平台上，因此系统的拓展性受到了限制。
法国科学家针对葡萄园种植特点，设计了葡萄白粉病和霜霉病专家决策系统，该系统能预测这两种葡萄疾病，并学习归纳不断增多的数据，完善系统关于白粉病和霜霉病的专家知识，具备较强的学习能力（Bertrand Léger，et al，2009）。
1.3.2 国内研究进展
在国内，研究者在20世纪80年代初才开始研究农业专家决策系统（葛文杰，等，2014），目前中国果园专家决策系统的开发研究仍处于初级阶段。
丰绪霞（1999）针对山区果园的特点，研发了果园灌溉专家系统，该系统能自动获取果园中的土壤含水率、土壤温度和空气湿度等环境因素，并将这些数据作为决策因子，做出灌溉决策。
毛明策等（2001）为了提高猕猴桃的产量和质量，开发了猕猴桃园专家系统，该系统包含节水灌溉、病虫害预测与防治、施肥方案规划等14个部分，集成度较高，功能比较完善。
王骞等（2005）针对渭北高原的环境情况，开发了基于.NET框架的苹果害专家系统，并建立了相关网站。该专家系统可以通过数据挖掘实现预测病虫害的功能，使决策结果智能化。
陈健等（2011）针对苹果园的管理现状，研发了苹果精准管理专家系统，该系统能实时监测苹果园的环境信息，并预测苹果的多种灾害，如病害和虫害等，然而缺乏灌溉时间预测与灌水量预报等功能。
王敏等（2014）为了改善苹果种植现状，设计了苹果园专家系统，该系统可以图形化显示苹果园的实时环境数据，并利用相关专家经验，建立多个预测决策模型，使系统做出精确决策。
马宁等（2015）为了减轻霜冻对果园的危害，开发了果园霜冻专家系统，该系统能定时远程监测果园环境信息，并通过天气预报获取未来环境信息，结合相关领域专家知识，自动预测霜冻的到来。
但以上系统没有充分考虑干旱级别对作物灌溉的影响，只是简单地根据作物生长水分阈值进行决策，而没有考虑影响灌溉的其他气象因素，如温度、湿度和降雨量等，使灌溉决策缺乏准确性。
1.4 论文主要工作
1.4.1 研究目的
本课题的研究目的是研发一套基于物联网的荔枝园信息获取与专家决策系统，该系统能实现以下功能：
（1）实时监测荔枝园的环境信息，如空气温度、空气湿度、土壤含水率和光照度等，并结合Zigbee网和GPRS网将数据传输到远程服务器的数据库中，这些环境数据作为专家系统决策的因素之一。
（2）专家决策系统获取用户输入的辅助信息后，结合信息采集终端模块监测的荔枝园环境数据，根据用户的不同选择，通过相应的灌溉模型做出决策，并将结果反馈到终端控制模块上；专家决策系统具备诊断荔枝病虫害、专家建议与答疑和知识管理的功能。
（3）终端控制模块能接受和分析来自专家决策系统的命令包，并控制电磁阀开启或关闭，实现智能灌溉。
1.4.2 主要内容
（1）系统介绍物联网技术的发展和作用，研究专家系统灌溉决策理论模型，详细分析专家开发的关键技术，为构建基于物联网的荔枝园信息获取和专家决策系统提供理论基础。
（2）从环境数据采集、网络拓扑结构、采集数据频率、网关模块及远程服务器设计和精确的决策模型设计等五个方面详细分析系统功能需求，介绍系统总体架构，并说明其工作流程。

 
图1.1  技术路线图
（3）研究设计系统的信息获取部分，包括短距离无线通信模块选型、处理器选型、信息采集终端模块软硬件设计、终端控制模块软硬件设计、网关模块软硬件设计和远程服务器模块软件设计，为专家决策系统决策提供了数据支持。
（4）设计专家决策系统的数据库，包括综合数据库和知识库；设计专家系统的施肥和病虫害决策规则、对荔枝病害和虫害分别进行归纳和分类，并通过软件编程实现专家系统的各个功能模块，使得专家系统可以接收信息获取部分采集的荔枝园实时环境信息数据，并结合部分辅助事实，作出智能决策。
（5）设计详细的试验方案，在荔枝园实际环境中对系统的工作性能进行了多个试验。包括网络丢包率试验、信息采集终端模块精度测试、专家系统灌溉决策准确性测试和专家系统决策实时性测试，汇总并分析试验数据，总结试验结论。
1.4.2 技术路线
本文的技术路线如图1.1所示，采用理论研究与试验研究相结合的方法，首先，对荔枝园信息获取和专家决策系统的应用需求进行详细分析，设计系统总体结构；接着，完成无线通信模块和处理器选型和信息获取部分的硬件设计以及软件编程；然后，设计专家决策系统数据、施肥与病虫害决策规则和对荔枝病虫害归纳分类，并实现专家决策系统各部分功能；最后，在荔枝园实地进行基础测试和系统试验，并分析试验数据，得出相关结论。
1.5 课题来源
本课题来源于国家荔枝龙眼产业技术体系建设专项资金项目（CARS-33-13）、广西科技计划项目（桂科AB16380286）和广州市科技计划项目（201605030013）。
1.6 本章小结
本章主要论述了本课题的研究背景及意义，包括荔枝的种植现状、物联网技术和果园专家系统等，接着分析了物联网技术在果园中的应用和果园专家系统的研究进展的国内外现状，最后介绍了本文的主要工作，包括研究目的，主要内容和技术路线，为接下来的工作指导了方向。





第2章 相关理论与技术
2.1 引言
充分的理论基础能够指导系统结构的正确设计；而通过对相关技术的研究，保证系统的各个部分的功能都得以实现，整个系统能正常运行，因此理论基础和技术研究都是必不可少的。
2.2 专家系统决策模型理论基础
2.2.1 水分与荔枝生长的关系
荔枝作为一种热带、亚热带果树，对气候条件的要求非常苛刻，其生长期分为花芽分化期（1～2月）、开花期（3月）、果实发育期（4～6月）和秋梢结果母枝生长期（7～12月）（刘翔宇，等，2012），不同生长期所需生长条件也不同，而水分在每个生长期都起着非常重要的作用。
2.2.1.1 水分在花芽分化期的作用
荔枝的花芽分化期为每年的1月到2月，此时北半球适逢冬季，研究表明，在秋冬季节适当的干旱可以增加荔枝产量，因为适当的干旱可以加强荔枝的光合作用，促进物质沉淀和花芽分化，如果水分太多，则不利于荔枝从营养生长向花芽生长转化（尹金华，等，2007）。但是，如果秋冬季的温度较低，则荔枝的花芽生长结果受水分的影响不大（Stern，et al.，2002），甚至当水分过少时，部分品种荔枝，如糯米糍的花芽生长会受到抑制（王泽槐，等，2007）。因此，在荔枝花芽分化期，其需要的土壤含水量要比花芽生长时的低，约为土壤持水率的60%（贾文君，等，2013）。
2.2.1.2 水分在果实发育期的作用
荔枝的果实发育期为每年的4月到6月，此时北半球适逢春季转夏季，研究表明，久旱骤雨打破了果肉和果皮之间的压力平衡，因此可以增加裂果率，大大增强荔枝果实的生长能力（蔡大鑫，等，2013）。所以，特别是在台风下雨之后，裂果的现象更加普遍（杨培林，等，2012）。
2.2.2 灌溉预报模型
	灌溉预报与决策模块是专家系统的核心内容，推理机根据荔枝种植专家的经验，根据模型库中灌溉预测和决策的数学模型，得出是否需要灌溉、灌溉时间和灌溉量等结果，实现了荔枝园节水灌溉的效果。
2.2.2.1计算参考作物蒸发蒸腾量
Penman-Monteith公式以能量平衡和水汽扩散化理论为基础，即考虑空气动力学和辐射项的作用，又涉及作物的生理特征，该公式综合考虑了各种气象因素对参考作物蒸发蒸腾量ET0的影响，具有扎实的推理基础，并且在世界上很多地方得到非常广泛地应用（丁加丽，等，2010）。Penman-Monteith公式为：
                          （1）
式中：
ET0为参考作物蒸发蒸腾量，mm/d；
△为饱和水气压-温度曲线上的斜率，kPa/℃，计算如下：
	                              （2）
其中，T为月平均温度，℃，即月最高和月最低温均值；
γ为湿度计常数，kPa/℃，计算如下：
                              （3）
其中，Pa为当地实际气压值，kPa；Z为海拔高度，m，计算如下：
                            （4）
μ2为离地面2 m高处风速，m/s，计算如下：
                                （5）
μH为离地面H m高处的风速，m/s，H为风速的施测高度，m。
ex为饱和水汽压，kPa，计算如下：
                                 （6）
其中，e0(T)=0.6018exp(17.27T/T+237.3); Tmax和Tmin分别为月最高和月最低温度。
ea为空气实际水气压，kPa，计算如下：
                                   （7）
其中，RHmeah为计算月的相对平均湿度，%；ex为饱和水汽压，kPa。
推理机结合信息采集终端模块监测的环境信息和用户输入的荔枝园地理信息、气象资料等，运用参考作物蒸发蒸腾量模型，计算出ET0。
2.2.2.2灌溉预报与决策模型
灌溉预报模型的原理是水平衡原理，其所需因素包括作物需水量、有效降雨量、地下水有效补给量和土壤有效存水量等。其中，作物需水量可由作物系数和参考作物蒸发蒸腾量相乘得出；有效降雨量可由土壤渗入特点和土壤初始含水率计算得出；地下水有效补给量可由土壤种类和地下水埋深计算得出；土壤有效存水量可由土壤初始含水率和适合作物生长的土壤含水率下限计算得出。
灌溉预报的功能是确定灌溉时间间隔，使用户在最佳时间灌溉，避免盲目灌溉造成的水资源的浪费，确定灌溉时间间隔要运用水平衡方程，其公式为：
                            	（8）
式中：
1）Pe为有效降雨量，在实际中，经常采用简化的计算方法，简化公式如下：
                                               （9）
式中，Pr为某次降雨的降雨总量，mm；σ为有效降雨系数，σ一般常取（丁加丽，等，2010）：
	                        （10）
2）ASW为土壤有效储水量，mm，计算如下：
	                          （11）
式中，L为作物根系活动层深度，m，r为土壤干容重，t/m3，θ0和θFC分别为土壤初始含水率和土壤实时含水率（占干土质量的%），Gx为作物适宜灌溉的土壤水分下限指标（占田间持水率的%）。
3）ETc为作物需水量，mm/d，计算如下：
	                                     （12）
式中，Kc为作物系数；ET0为参考作物蒸发蒸腾量，mm/d。
4）Ge为地下水补给量，mm/d，计算如下：
                                （13）
式中，B为地下水补给系数，与作物类型，土壤特性有关；GWD为地下水埋深，m；ETc为作物需水量。
2.3 专家系统开发关键技术
2.3.1 Web平台
由于计算机和互联网等技术的快速发展，为保证系统具有较为长久的生命周期，荔枝园专家系统的设计应采用一种较为先进的技术（Zhu Y，et，2008）。荔枝园专家系统采用JSP+JavaBean+Servlet开发模式。该开发模式遵循了MVC（Model-View-Controll）设计模式的思想，JSP将信息显示在网页上，JavaBean处理业务逻辑，Servlet则控制系统的执行过程和调用业务逻辑，完全分离了模型层、视图层和控制器层。此开发模式具有独特的优势：程序结构比较简单，容易控制流程，便于维护系统。
2.3.2 编程语言
MyEclipse 是一个使用Java语言开发的平台。这个集成环境中具有很多强大的插件，并支持PHP和C/C++等多种编程语言。而Java作为一种面向对象编程语言，用Java开发的软件具有比较强大的可移植性。
2.3.3 数据访问
荔枝园专家系统的数据访问工具采用基于XML的ADO.NET。ADO.NET作为一种新的数据库访问技术，可以代替ADO.（Li，et，2011）。ADO.NET 的数据源之一是以XML为输出的数据源，其结果集变成数据集，命令语句就变为数据集命令。由于ADO.NET是基于XML的，因而它能处理更为多种多样的数据源（丁筱玲，等，2015）。
2.3.4 网络结构模式选型
网络结构模式有B/S（Brower/Server）模式，即浏览器/服务器模式和C/S（Client/Server）模式，即客户端/服务器模式。C/S模式要求用户在电脑上安装相关的应用程序，而在B/S模式下用户只要通过浏览器就可以访问系统，进行相关操作。因而，系统采用B/S模式可以大大减轻客户端的负担和降低服务器端的维护成本。
2.3.5 AJAX技术
为了让用户有更好的体验感觉，系统选择使用AJAX（Asynchronous JavaScript and XML）技术：AJAX技术的特点是，利用局部刷新技术更新页面而不是更新整个页面，这样才能更快地操作数据，导致用户的体验感觉良好。
2.4 本章小结
本章介绍了专家系统决策模型的理论基础，分析了水分与荔枝生长的关系和灌溉预报模型的推导；同时，说明了开发专家系统的关键技术，包括Web平台搭建、编程语言和数据访问方式等，为系统设计，特别是专家系统功能实现提供了理论支持和技术指导。





















第3章 荔枝园信息获取软硬件设计
3.1 引言
根据荔枝生长和果园环境的实际特性，本章先详细分析系统需求，构建系统整体架构，接着对系统中的信息获取部分进行了硬件设计，并在硬件基础上完成软件设计，最后设计远程服务器模块，完成对荔枝园空气温度、空气湿度、光照度和土壤含水率实时信息的获取。
3.2 系统架构设计
3.2.1 系统需求分析
搭建系统的信息获取部分是为了实时采集荔枝园环境信息，向专家决策系统提供数据支持。而专家决策系统则结合相关环境数据和用户输入的辅助事实，作出精准决策。因此，本系统需求分析如下：
（1）可靠精确的环境数据的采集：专家系统决策的数据来源之一是荔枝园环境信息数据，因而环境数据的正确性直接影响到整个系统的决策准确性。根据荔枝园实际环境状况，本系统需要选取能耗比较低、大小合适、精度较高的传感器来监测土壤含水率、空气温度、空气湿度和光照度等环境数据。
（2）合适的网络拓扑结构：网络拓扑结构的合理性对系统的丢包率产生着至关重要的影响。本系统的网络结构选择丢包率较低和设备成本不高的树形网络拓扑结构。
（3）网关模块及远程服务器模块：网关模块作为整个系统的协议转换设备，需通过Zigbee网接收所有信息采集终端模块数据后，再通过GPRS网络将数据传输至远程服务器模块上，实现协议间的转换。同时，远程服务器模块需要实现接收网关模块的连接请求，接收并保存荔枝园环境数据到数据库中，为专家系统决策提供数据支持的功能。
（4）完善的专家决策系统：为了辅助用户科学地管理荔枝园，专家决策系统应该具备以下功能：
①接收用户输入辅助事实：荔枝园资料、气象信息、荔枝生长情况等；
②灌溉预测与决策：灌溉时间预测、灌溉决策、施肥决策等；
③诊断荔枝病虫害：诊断荔枝病害和虫害；
④专家建议与答疑：专家在线回答问题、用户能提出问题和查看答案；
⑤系统管理：管理数据库、管理用户信息等。
3.2.2 系统总体架构
基于物联网的荔枝园信息获取与专家决策系统分为信息获取部分和专家决策系统两部分。信息获取部分由3个部分构成，包括终端监控设备、网关模块、远程服务器模块。其中，终端监控设备通过 Zigbee网与网关模块通信，网关模块通过无线分组网（general packet radio service，GPRS）与云服务器模块通信；专家决策系统由6个模块组成，包含数据库模块、知识库模块、推理机模块、解释机模块、知识获取模块和人机交互界面模块，其决策结果通过远程服务器传输给网关模块，网关模块则通过Zigbee网将该结果发送到终端监控模块上。而用户们，包括果农、专家和系统管理者，则可以使用浏览器与专家决策系统进行交互。系统总体架构如图3.1所示。


图 3.1 系统总体架构

系统各模块功能如下：
信息采集终端模块：监测荔枝园的温度、湿度和土壤含水率等多种环境参数，组合成环境信息数据包，并通过无线传感网将该数据包传输到所述网关模块；
终端控制模块：通过无线传感网接收来自网关模块的指令包，解析指令包后再对电磁阀进行开启或者关闭操作；
网关模块：在信息采集终端模块和控制终端模块休眠的时候，网关模块将数据进行格式化处理，利用GPRS模块与远程服务器模块建立起TCP/IP连接，通过互联网将数据发送到远程服务器模块；
远程服务器模块：将空气温度、空气湿度、光照度、土壤含水率等多个环境参数、每个信息采集终端模块实时电压值和控制终端模块的电磁阀状态存储到数据库模块；
数据库模块：存储来自网络服务器模块的多个荔枝园的环境参数、存储来自推理机模块的中间推理结论和最终结论、存储来自解释机模块的最终结果、存储来自人机交互界面模块的事实数据以及向推理机模块提供事实数据；
知识库模块：接收并存储知识获取模块中的专家知识，将专家知识发送给推理机模块和解释机模块，同时将决策结论发送给解释机模块；
推理机模块：从事实数据从数据库模块中读出，结合来自知识库模块的专家知识，通过灌溉模型或者决策规则进行推理，得出结论；
解释机模块：显示专家决策系统的推理过程和相关结论，解释相关领域的专家知识，对一般用户有着指导作用；
知识获取模块：将相关领域专家录入的知识进行解析、归类和整理，并将专家知识保存到知识库模块的相关表格中；
人机交互界面模块：专家系统通过该模块接收用户输入信息和向用户反馈相关信息。
3.2.3 系统工作流程
系统决策主要分为灌溉预报与决策和诊断荔枝病虫害。灌溉预报与决策时，专家系统将信息采集终端模块采集的荔枝园实时环境信息和用户输入的变量作为决策模型的决策因子，根据决策模块，实现了计算需水量、灌溉预测、灌溉决策和施肥决策等功能；诊断荔枝病虫害时，通过人机交互模块接收用户选择的荔枝病害或虫害特征，与知识库中决策规则的特征一一匹配，得出该荔枝病害或虫害名称。系统工作流程如图3.2所示。
3.3 硬件设计
3.3.1 终端监控设备硬件设计
终端监控设备是系统的底层部分，包括终端信息获取模块、终端控制模块和电磁阀，能实时采集荔枝园环境信息，并控制电磁阀进行灌溉。

 
图3.2  系统工作流程如图
3.3.1.1 短距离无线通信模块选型
目前一般的监控系统常用的短距离无线通信模块（朱焕立，等，2009）主要有3种，分别是Zigbee模块、Wifi模块和蓝牙模块，各种模块特性对比如表3.1所示。
通过表 3.1可以得出，蓝牙模块的通信距离比另两种模块更短，因而在监测荔枝园环境时需要该模块数量会比较多，Wifi 模块相对于另两种模块，其抗干扰性一般，因而数据传输的可靠性无法得到保证。所以，终端监控设备中的信息采集终端模块和终端控制模块均选择通信距离较长和抗干扰能力较强的 Zigbee 模块作为短距离无线通信模块。

表3.1  局域无线通信模块特性对比

3.3.1.2 处理器选型
终端监控设备中的信息采集终端模块和终端控制模块均采用微处理器STM32F103C8T6作为核心处理器，STM32F103C8T6作为一款新型的32位嵌入式微处理器，并且它是基于Cortex- M3内核的，其性能比51系列单片机优越，且使用的开发软件和开发过程简单易懂，可替代多种普通单片机应用于多个场合。
STM32F103C8T6微处理器主要资源和特点如下：
（1）51个I/O口，全部I/O口均都能和16个外部中断对应起来，所有端口均可以通过软件将其配置成输出、输入或其它功能口。
（2）调试模式：支持常规的20引脚JTAG仿真调试功能。因而用户通常选择JTAG作为默认的调试接口。
（3）2个模数转换器，均为12位，具有16个外部输入通道，具有1MHz的转换速率，0-36V的转换范围。
（4）多个通信接口：3个USART接口、2个I2C接口、2个SPI接口、和1个USB接口，保证了数据通信的有效性。
（5）内部具有3个定时器。
3.3.1.3 信息采集终端模块
信息采集终端模块是系统采集荔枝园实时环境数据的关键部分（谢家兴，等，2014）。该模块通过不同传感器定时采集多个荔枝园环境数据，经STM32F103C8T6处理器分析整理后，通过Zigbee无线通信模块传输到网关模块。信息采集终端模块由无线通信模块、处理器模块、传感器模块和电源监控模块等4个部分组成，其硬件结构框图如图3.3所示。


图3.3  信息采集终端模块硬件结构框图

	信息采集终端模块定时自动监测荔枝园环境数据，处理器模块接收来自传感器模块的数据，分析和处理后，利用无线通信模块将数据包传送到网关模块。当信息采集终端模块进入休眠状态时，处理器模块通过电源管理模块可以切断无线通信模块和各个传感器的电源，降低了休眠时信息采集终端模块的功耗。
（1）无线通信模块。无线通信模块负责组建Zigbee网，并负责发送和接收数据包。基于§3.3.1.1的分析，无线通信模块选用CC2530，其电路原理图如图3.4所示。


图3.4  CC2530电路原理图

（2）处理器模块。处理器模块负责信息采集终端模块的分析、整理数据以及控制信息采集终端模块的各种操作，如进入休眠状态等。由§3.3.1.2的分析，处理器模块选用STM32F103C8T6，其最小系统电路原理图如图3.5所示。

图3.5  STM32F103C8T6最小系统电路原理图

（3）传感器模块。针对荔枝园实际环境的监测需求，采用广州奥松电子有限公司开发的DHT22温湿度传感器采集荔枝园空气温湿度，其实物图和接口电路分别如图3.6和图3.7所示；采用锦州阳光科技有限公司开发的TDR-3土壤水分传感器采集荔枝园土壤水分含水率，其实物图和接口电路分别如图3.8和图3.9所示；采用罗姆半导体生产企业开发的GY-30光照度传感器采集荔枝园光照度，其实物图和接口电路分别如图3.10和图3.11所示。DHT22温湿度传感器的数据采集精度为空气温度：±0.5℃和相对湿度：±3%，TDR-3土壤水分传感器的数据采集精度为±2%（m3/m3），GY-30光照度传感器的最小测定单位为1lx，测量范围是0到65535lx。

                 
图3.6  DHT22空气温湿度传感器   图3.7  DHT22温湿度传感器接口原理图

               
图3.8  TDR-3土壤水分传感器    图3.9  TDR-3土壤水分传感器接口原理图
                  
图3.10 光照度传感器GY-30        图3.11  光照度传感器接口原理图
        
（4）电源监控模块。电源监控模块由电源供给模块、电压检测模块和电源控制模块3部分组成，本系统的信息采集终端模块和终端控制模块均采用相同的电源监控模块。
①电源供给模块
电源供给模块主要包含3个部分，分别是5V稳压输出电路和3.3V稳压输出电路，其电路原理图分别如图3.12和图3.13所示。其中，由于AMS1117是正向低压降稳压器，内部集成过热保护和限流电路，所以本模块的5V稳压输出电路和3.3V输出稳压电路的稳压芯片分别采用AMS1117-5和AMS1117-3.3。


图3.12  5V稳压输出电路原理图


图3.13  3.3V稳压输出电路原理图

②电压检测模块
为了能实时监测电池电量，方便用户管理设备，电路设计上增加了电压监测模块。由于20kΩ和5kΩ的电阻比为4：1，所以处理器模块通过ADC引脚采集到的电压为电源电压的1/4。电源电压低于2.5V时，用户能及时替换电池，使系统能正常运作。
③电源控制模块
电源控制模块的设计原理为，在信息采集终端模块进入休眠状态时，处理器模块通过电源控制模块切断各个传感器和无线通信模块的电源，以降低模块在休眠时的功耗，电路原理图如图3.14所示。


图3.14  电源控制模块原理图

信息采集终端模块还包含电源指示灯、信号灯和微处理器程序烧写模块等部分，其实物图如图3.15所示。


图3.15  信息采集终端模块实物图
3.3.1.4 终端控制模块硬件设计
终端控制模块包括处理器模块、无线通信模块、电磁阀驱动电路模块和电源监控模块等4个部分，其硬件结构框图如图3.16所示。



图3.16  终端控制模块硬件结构框图

本文采用双稳态脉冲电磁阀作为灌溉控制设备，其原理是向励磁线圈施加适当的脉冲电流，可以控制阀门开启或关闭，当该电流消失后，阀门状态就不会变化（尹永利，等，2014）。本系统采用ZJ-S201B胶双稳态脉冲电磁阀，正常工作电压为3.6V，其实物图如图3.17所示。


图3.17  ZJ-S201B胶双稳态脉冲电磁阀实物图

终端控制模块的硬件设计和信息采集终端模块比较相似，其中，处理器模块、无线通信模块和电源监控模块的设计均可以参照§3.3.1.3。电磁阀驱动电路模块选择驱动器芯片L9110S作为ZJ-S201B胶双稳态脉冲电磁阀的驱动源，其电路原理图如图3.18所示。

图3.18  ZJ-S201B胶双稳态脉冲电磁阀驱动电路原理图

3.3.1.5 路由模块硬件设计
路由模块作为数据中转设备，其硬件设计包括处理器模块、无线通信模块和电源监控模块等3个部分，硬件结构框图如图3.19所示。


图3.19  路由模块硬件结构框图

3.3.2 网关模块硬件设计
网关模块硬件主要包括电源模块、电源监控模块、处理器模块、协调器模块、GPRS模块、串口通信模块、485通信模块、存储模块和状态指示模块。其中，协调器模块和处理器模块的选型分别参考§3.3.1.1和§3.3.1.2；GPRS模块选择GPRS-DTU模块；存储模块选择TF卡，使网关模块本身可以存储数据。网关模块硬件结构框图如图3.20所示。
网关模块通过串口模块接收协调器模块汇聚数据，并通过GPRS模块转发至远程服务器，其实物图如图3.21所示。


图3.20  网关模块硬件结构框图


图3.21  网关模块实物图
3.4 软件设计
3.4.1 终端监控设备软件设计
3.4.1.1 组网方式
目前，Zigbee网络一般有3种组网方式，分别是星型、树型和网状型（Adamchuk V I, et al, 2004；Zhang Qian, et al, 2007），如图3.22所示。


图3.22  3类Zigbee网络组网方式

星型方式比较简单且方便管理，但由于荔枝园里荔枝树和电线杆等对无线信号有一定的阻挡，因而星型网络的覆盖面积会受限制，而网状型方式虽然可以降低丢包率，但是投放的节点数量过多，成本较高，所以本文选择树形组网方式。
3.4.1.2 信息采集终端模块软件设计
设计思路如下：各个信息采集终端模块依次启动后，自动搜索并加入网关模块创建的Zigbee网中，获取自身短地址，并初始化模块的各个功能部分，接着自动每隔30分钟采集荔枝园的环境信息，通过 Zigbee 网将数据包发送到网关模块上，此后进入休眠模式。如果采集到的土壤含水率数据达到预设的阈值时，信息采集终端模块接收命令包后，依据包里的新采集周期运行。具体方案为：当土壤含水率低于设定的下限时，采集周期更新为10分钟；当土壤含水率高于设定的上限时，采集周期更新为1小时。当信息采集终端模块被唤醒后，就根据新的采集周期进行数据采集工作。信息采集终端模块程序流程图如图3.23所示。


图3.23  信息采集终端模块程序流程图

3.4.1.3 终端控制模块软件设计
软件设计思路如下：终端控制模块上电后，自动搜索并加入网关模块创建的Zigbee网中，获取自身短地址，并初始化模块的各个功能部分，将自身设备号、数据包号、电磁阀状态和电池实时电量等信息组合成一个信息数据包，通过Zigbee网发送到网关模块，并等待来自网关模块的命令数据包，通过分析数据包得到电磁阀操作命令和休眠时间，执行相应的电磁阀操作后再重发信息数据包给网关模块，此后进入休眠模式，其程序流程图如图3.24所示。


图3.24  终端控制模块程序流程图

3.4.1.4 路由模块软件设计
设计思路如下：路由模块上电后，自动搜索并加入网关模块创建的Zigbee网中，获取自身短地址。路由模块负责转发终端监控设备和网关模块间的数据。其程序流程图如图3.25所示。
3.4.2 网关模块软件设计
网关模块是整个监控系统的协议转换设备（余国雄，等，2016），网关模块启动后，建立 Zigbee 网并启动监听，接收来自终端信息获取模块的数据包，进行分析、压缩和融合数据后，通过 GPRS 网络将数据发送到云服务器模块，并通过 Zigbee网将同步数据包发送到终端信息获取模块，使其与网关进行时间同步后，进入休眠模式，降低功耗；网关与云服务器建立 TCP/IP 连接，通过 GPRS 网络接收并解析来自云

图3.25  路由模块程序流程图

服务器模块的决策结果数据包后，通过 Zigbee 网发送到终端控制模块，进而控制电磁阀，之后，终端控制模块与网关进行时间同步，也进入低功耗休眠模式。网关模块的工作流程如图3.26所示，实现了 Zigbee-GPRS 网络协议的转换、使 Zigbee 网具备实时性和维持 Zigbee 网的稳定性等功能。
3.4.3 远程服务器模块设计
3.4.3.1 工作原理
远程服务器模块采用 TCP 并发服务器模型，允许最多 10个网关模块同时连接，服务器等待网关模块的连接，当网关模块有连接请求时，就创建 1 个新线程处理该网关模块的业务，将网关模块的数据包进行分析、计算后，存储到数据库中，供专家决策系统调用；同时，远程服务器模块在每个线程中采用轮询算法，循环查询专家系统决策结果数据库是否有更新，若有，从中读取决策结果，整理成数据包后，通过 GPRS网络传输到对应的网关模块上，工作流程如图3.27所示。
3.4.3.2 数据通信协议
服务器模块和网关模块间的数据通信是整个系统的数据交互核心，为了保证系统能正常运行，必须规定服务器模块和网关间的数据通信协议。服务器模块和网关模块间的通信数据包主要有荔枝园实时环境信息数据包、专家系统决策结果命令包和数据

图3.26  网关模块工作流程图

包重发命令包等，每个数据包或者命令包均包含包头、标志位、数据位和包尾等，例如，如荔枝园实时环境信息数据包的数据格式如图3.28所示，其中，包头表示数据包从该处开始，包尾表示数据包在此处结束。


图3.27  远程服务器模块工作流程

图3.28 荔枝园实时环境信息数据包的数据格式

3.4.3.3 数据交互方式
远程服务器模块和网关模块间的数据交互通过字符流的形式进行，荔枝园多个实时环境信息、各模块剩余电量等数据保存到数据库的对应表格中，供专家决策系统调用，具体表格设计见§4.2.1中的表4.7，荔枝园实时监测表。专家决策系统进行决策后，将决策结果存储到数据库的对应表格中，远程服务器定时自动读取该表格中的决策结果，将命令数据包通过GPRS网发送给网关模块。网关模块和服务器模块的数据交互方式如图3.29所示。


图3.29 服务器模块和网关模块的数据交互方式图
3.4.3.4 功能设计与实现
采用开发软件Visual Studio 2010设计远程服务器模块，基于.NET Framework 4.0，使用可视化控件、网络编程类、多线程编程技术、数据控件和数据库编程，实现了响应多个客户端的连接请求、接收、显示和存储数据等功能。
当服务器模块接收到客户端的连接请求后，就和客户端间建立起基于TCP/IP协议的连接，运行时界面如图3.30所示。其中，用户可以通过历史数据查看与操作功能选项查询过去时间段内当荔枝处于不同生长周期时，荔枝园环境的变化状况，为用户做出科学的防治措施提供了数据支持。


图3.30  远程服务器模块运行界面

3.5 本章小结
本章从环境数据采集、网络拓扑结构、网关模块及远程服务器模块设计和专家决策系统等5个方面详细分析了系统功能需求，介绍了系统的总体架构，详细说明了系统的工作流程；并对系统的信息获取部分进行了详细设计，包括短距离无线通信模块选型、处理器选型、信息采集终端模块软硬件设计、终端控制模块软硬件设计、网关模块软硬件设计和远程服务器模块软件设计，为专家决策系统决策提供了数据基础和支持。






第4章 荔枝园专家决策系统设计
4.1 引言
专家决策系统把数据库作为存储载体，建立相关灌溉决策模型，并设计相关决策规则，根据用户输入的辅助事实和信息获取模块采集的荔枝园实时环境信息数据，进行智能决策，指导用户更加科学地管理荔枝园。
4.2 数据库设计
数据库是专家决策系统的重要数据支撑，分为综合数据库和知识库，综合数据库用于存储事实、推理过程和决策结果等；知识库则用于存储专家系统决策所遵循的规则和模型以及领域专家的知识。
4.2.1 综合数据库
本文依据荔枝园实际环境的监测、灌溉和管理需求，在综合数据库中设计了11个相关数据表，分别如下：
（1）荔枝园基础信息表：basic_info，存储着各荔枝园的名称、所处省份、经纬度、气候带和海拔等地理信息，具体如表4.1所示。

表4.1  荔枝园基础信息表

（2）荔枝园气象信息表：mete_info，存储着各荔枝园的最高气温、最低气温、平均湿度、最高湿度、最低湿度、2m处平均风速、降雨量和日照时数等气象信息，具体如表4.2所示。
表4.2  荔枝园气象信息表

（3）荔枝信息表：crop_info，存储着荔枝的多种信息，如荔枝品种、荔枝所处生育期和根系活动层深度等，具体如表4.3所示。

表4.3  荔枝信息表

（4）荔枝园土壤特性表：soil_info，存储着荔枝园土壤多种信息，如土壤质地类别、地下水埋深、地下水补给系数、土壤干容量和土壤实时含水量等，如表4.4所示。
表4.4  荔枝园土壤特性表

（5）荔枝种植知识表：plantknow，存储着荔枝的多种种植知识信息，如荔枝品种、荔枝所处生育期和文章标题等，具体如表4.5所示。

表4.5  荔枝种植知识表

（6）病虫害知识表：insectpests，存储着荔枝病虫害的相关信息，如文章标题、文章路径和用户类型等，具体如表4.6所示。
（7）荔枝园实时监测表：wsn_information，存储着荔枝园的如空气温度、空气湿度、土壤含水率和光照度等实时环境信息，具体如表4.7所示。
表4.6  病虫害知识表

表4.7  荔枝园实时监测表

（8）用户信息表：user_info，存储着用户的相关信息，如用户名、密码和用户类型等，具体如表4.8所示。
表4.8  用户信息表

（9）荔枝园灌溉预测表：water_result，存储着荔枝园的灌溉预测的决策因素和结果，如荔枝生育期、计算年份、计算月份和灌溉时间间隔等，具体如表4.9所示。
表4.9  荔枝园灌溉预测表

（10）用户疑问表：user_question，存储着用户疑问的相关信息，如用户名、提问时间、问题标题和回答状态等等，具体如表4.10所示。

表4.10 用户疑问表

（11）专家答案表，存储着专家对于用户疑问的答案信息，问题标题、回答专家用户名、回答时间和回答标题等，具体如表4.11所示。

表4.11  专家答案表

4.2.2 知识库
本文依据专家系统灌溉、施肥和识别荔枝病虫害决策所需规则，在知识库中设计了8个相关数据表，分别如下：
（1）作物系数规则表：parakc，存储着不同生长周期时，多个荔枝品种的作物系数，具体如表4.12所示。

表4.12  作物系数规则表

（2）土壤特性规则表：rule_soil，存储着在不同土壤种类下，多个荔枝品种的适合生长水分信息，如土壤水分含量上限和下限等，具体如表4.13所示。
（3）土壤水分规则表：rule_water，存储着各荔枝品种在不同土壤种类下的水分阈值信息，如土壤水分含量上限和下限等，具体如表4.14所示。
（4）一般施肥决策规则表：rule_comfer，存储着各荔枝品种在不同生育期和树龄下的施肥决策信息，如N使用量、P2O5使用量、K2O使用量和施肥月份说明等，具体如表4.15所示。

表4.13  土壤特性规则表

表4.14  土壤水分规则表

表4.15  一般施肥决策规则表

（5）根据灌溉制度决策规则表：rule_regime，存储着在不同生育期时，多个荔枝品种的需水量、灌溉周期和灌溉量等灌溉信息，具体如表4.16所示。

表4.16  根据灌溉制度决策规则表

（6）目标产量施肥决策规则表：rule_targetfer，存储着各荔枝品种在不同树龄下的需要达到目标产量的施肥决策信息，如N使用量、P2O5使用量和K2O使用量等，具体如表4.17所示。

表4.17  目标产量施肥决策规则表

（7）荔枝病害决策规则表：rule_disease，存储着荔枝病害的相关信息，如病害特征、病害名称和防治方法等，具体如表4.18所示。
（8）荔枝虫害决策规则表：rule_insect，存储着荔枝虫害的相关信息，如虫害特征、虫害名称和防治方法等，具体如表4.19所示。
4.3 施肥与病虫害决策规则设计
本文根据国内外的相关文献，为施肥决策和荔枝病虫害诊断设计了决策规则，根据用户选择的条件，专家系统进行判断，最终得出施肥决策和荔枝病虫害诊断结果。
表4.18  荔枝病害决策规则表

表4.19  荔枝虫害决策规则表

4.3.1 一般施肥方案决策
本文通过研究相关文献，整理相关的专家知识经验，归纳出一般施肥方案决策模块（王仁玑，等，1993；樊小林，等，2004），该模块决策过程如图4.1所示。


图4.1  一般施肥方案决策模块决策过程
一般施肥方案决策模块决策规则表4.20所示：

表4.20  一般施肥方案决策模块决策规则表

4.3.2 目标产量施肥决策
如何施肥直接影响着荔枝的产量高低，本文根据相关文献的专家知识经验，归纳出目标产量施肥决策模块（王仁玑，等，1993；李荣昌，1994；陈永兴，2009），该模块决策规则如表4.21所示：

表4.21  目标产量施肥决策规则表

4.3.3 荔枝病害诊断
能否有效的诊断并预防荔枝病害直接影响着其果实的质量高低，本文根据相关文献的专家知识经验，归纳出荔枝病害诊断模块（陈元洪，1999；刘双水，2003；黄梁新，2013；周春娜，等，2015，曾蓉姿，2015），并根据病害的发病部位，将荔枝病害分为5类，为叶片病害、果实病害、树枝病害、叶片果实综合病害和叶片树枝综合病害。
4.3.3.1 叶片病害
叶片病害决策规则共5条，分别如下：
规则1：如果符合以下症状：①初期时黄褐色像针头般大小的圆点出现在叶面上，慢慢向周围散开，变为圆形或有着不整齐边缘的毛毡状斑。毛毡状斑略为突起，表面出现向四周放射且较细的纹路；②毛毡状斑会不断往周围展开，斑的中央慢慢出现老化现象，变为灰绿色，有的表面比较润滑，有着较深的颜色，边缘一直为绿色。藻斑形状大小不定，较大的直径为10毫米；则该病害为荔枝藻斑病。
规则2：如果符合以下症状：初期叶片受害时，片上会长出很多较小的斑点，并且这些斑点失去绿色；叶片的受害程度不断加重，导致叶片失绿比较严重，出现淡黄色或淡红色，引起落叶，对树的长势和坐果率产生非常严重的影响；则该病害为荔枝二斑叶螨病。
规则3：如果符合以下症状：叶片是主要的受害部位，多数从叶尖或叶缘开始受害，初期呈褐色，之后变成灰褐色甚至灰白色，叶缘呈紫褐色，后期病斑上长出浓密的黑色小颗粒；则该病害为荔枝叶枯病。
规则4：如果符合以下症状：叶片是主要的受害部位，初期时叶片上下两面长出形状不规则的褐色斑点，叶缘更为集中，随之转为灰色，病斑上长出黑色小颗粒；则该病害为荔枝灰斑病。
规则5：如果符合以下症状：叶片表面或边缘长出病斑，初期时病斑为褐色，后慢慢地扩展为圆形和形状不规则的大斑块，且病斑中部呈灰白色，斑上长出黑色的小颗粒；则该病害为荔枝枯斑病。
4.3.3.2 果实病害
果实病害决策规则共1条，分别如下：
规则1：如果符合以下症状：①初期时发病部位呈现褐色，后期颜色慢慢变为暗褐，慢慢扩散到整个果实，到整个果实腐烂为止，这时果肉腐坏，气味较臭，果壳变硬，流出臭水；②发病部位长着霉状物，呈白色；则该病害为荔枝酸腐病。
4.3.3.3 树枝病害
树枝病害决策规则共2条，分别如下：
规则1：如果符合以下症状：①初期时发病的树皮色泽暗淡，慢慢地开始浓缩，长出裂痕；②后期时，龟裂更加严重，某些皮层会翘起，木质部还会受到病菌的危害，导致受害枝条上的叶片出现脱落，病枝枯死；则该病害为荔枝溃疡病。
规则2：如果符合以下症状：①发病部位在于荔枝树干和较粗的枝条，病原以树皮为食，消减树的长势，导致树枝过早衰老。②在长势茂盛的树木和密不透风的荔枝园，湿度较大而地势较低导致该病害频繁的出现。则该病害为荔枝藻类及地衣病。
4.3.3.4 叶片果实综合病害
叶片果实综合病害决策规则共5条，分别如下：
规则1：如果符合以下症状：①果实为受害部位之一，初期时褐色且形状不规则的病斑会出现在果皮表层，随着病斑的慢慢扩散，最后导致整个果实变成黑色，果皮表层长出霜霉状物，呈白色；②叶片受害也为受害部位，初期时叶片表面呈现褪色小粒点，慢慢扩展为形状不规则的浅绿病斑，并且斑的表面长着霜霉状物，呈白色；则该病害为荔枝霜疫病。
规则2：如果符合以下症状：果实如果染病，表面首先会出现圆形、稍微凹陷的小点，慢慢扩展成形状不规则的病斑，病斑上出现黑色较粘的小颗粒，受害的果肉会腐败变臭，染病的树生长缓慢，导致叶片慢慢枯萎而死，树上的病枝叶往往是初次侵染的部位；则该病害为荔枝炭疽病。
规则3：如果符合以下症状：①小叶柄会长宽，严重时导致新梢节变短，呈现扫帚状，幼叶会落光；②花穗受到伤害时，节间会缩短，变得形状不规则，很难开花结果，即使能结果，其果实也比较小，果肉味道较淡；则该病害为荔枝丛枝病。
规则4：如果符合以下症状：①受害部位是枝梢、叶片和果实，在病原表面长出霉层，呈暗褐色，后期在霉层上长出黑褐色小颗粒突起物；②如果一些果园病情比较严重，果树的树冠上好像被一层煤烟盖着那样，阻碍了了果树的光合作用；则该病害为荔枝煤烟病。
规则5：如果符合以下症状：①叶片染病时一般在幼小叶片的正面上能看到粉层，呈白色；②果实受到感染时，初期时白色粉层会出现在裂开的果皮缝隙间；伴随着果实的不断变大，粉层会一直扩散到裂开的叶片上，裂片会呈褐色；③果实变红的时候，由于白粉菌的感染，果皮会呈褐色，并且变硬；则该病害为荔枝白粉病。
4.3.3.5 叶片树枝综合病害
叶片树枝综合病害决策规则共2条，分别如下：
规则1：如果符合以下症状：①刚刚受害时，叶片上会长出黄绿色小斑点，接着慢慢变成形状不规则的块状斑，受感染的叶片长出凹凸不平的像毛毡的绒毛状物，开始时呈黄色，之后变为红褐色，受害叶片边缘和叶背都发生曲折；②嫩枝和花穗会因为受到感染而变为形状不规则。花器受害。畸形膨大成簇，不能结果；则该病害为荔枝毛毡病。
规则2：如果符合以下症状：染病的树株地上部叶片绿色渐退，慢慢变黄后枯萎至死。地下部根茎到根变为褐色，皮层产生腐烂。5到6月或一到二年生的实生苗比较容易受到感染，严重时病株率可达10%；则该病害为荔枝镰刀菌根腐病。
4.3.4 荔枝虫害诊断
能否有效的诊断并预防荔枝虫害直接影响着其果实的质量高低，本文根据相关文献的专家知识经验，归纳出荔枝虫害诊断模块（陈元洪，等，1999；李敦松，2000；杨银桥，2010；普云，2014；陈广全，等，2015；钟艳秋，2015），并根据虫害的发病部位，将荔枝虫害分为6类，为叶片虫害、花朵虫害、果实虫害、树枝病害、叶片果实综合虫害和叶片树枝综合病害。
4.3.4.1 叶片虫害
叶片虫害决策规则共4条，分别如下：
规则1：如果符合以下症状：①幼虫在刚刚孵化后，就缀结叶尖，上表皮和叶肉被藏在叶中的幼虫不断吸食，最后生长下表皮，使卷叶出现枯萎和薄薄薄的斑纹；②树叶被大龄幼虫咬食而出现孔洞；则该虫害为卷叶蛾。
规则2：如果符合以下症状：叶片出现卷缩、枯萎，导致严重减产；则该虫害为蚜虫。
规则3：如果符合以下症状：①幼叶时受害部位之一，叶背上会先长出黄绿色的斑块，斑块有凹处，此处会出现小绒毛，无色透明，慢慢变为乳白色；②随着瘿螨为害程度加深，感染部位绒毛加多，呈现黄褐色，最后变为深褐色；则该虫害为荔枝瘤瘿螨。
规则4：如果符合以下症状：花瓣和叶片是成虫危害得最为频繁的部位，成虫把叶片吃得仅剩下叶脉，也以豆荚为食，严重影响荔枝产量；则该虫害为荔枝大斑芫菁。
4.3.4.2 花朵虫害
叶片虫害决策规则共3条，分别如下：
规则1：如果符合以下症状：①如果荔枝花穗和果柄的部位被荔枝蝽象咬食过，那么这些部位在变黑的同时，会产生一些白沫；②如果荔枝花穗和果柄的部位被荔枝蝽象的尿液喷射到，这些部位会呈现形状不规则的块斑；则该虫害为椿象。
规则2：如果符合以下症状：①花穗尾部在花期时呈现异于常态的枯萎；②花穗中部或者下部在花期时会存在一些粉状虫粪并出现中空的现象；则该虫害为蒂蛀虫。
规则3：如果符合以下症状：花蕾、嫩叶和花朵在花期时完全被吃光，导致果实产量减少，幼根也受到幼虫的食害；则该虫害为金龟子。
4.3.4.3 果实虫害
叶片虫害决策规则共6条，分别如下：
规则1：如果符合以下症状：果实和叶背是受害部位之一，它们会变为古铜色，并且粗糙，黯淡无光，导致叶片枯萎掉落，果皮变黑；则该虫害为锈蜘蛛。
规则2：如果符合以下症状：①荔枝的嫩梢和果实主要受到成虫的危害，而果实受到的危害特别严重；②幼果受到危害后生长缓慢，严重的果实会掉落；则该虫害为介壳虫。
规则3：如果符合以下症状：果实受到危害后会变黄，但没有成熟，导致果实脱落，严重影响果实产量和质量；则该虫害为小实蝇。
规则4：如果符合以下症状：果实被幼虫危害，果实受到危害后，初期时会出现局部变黑，轻者果实变黑、形状变得不规则，重者整个果实会变干和变硬，但果实不会脱落；则该虫害为斑螟。
规则5：如果符合以下症状：果皮下是成虫产卵的场所，幼虫汇聚在果实里并咬噬果肉，导致果实收缩变臭；则该虫害为蛀果虫。
规则6：如果符合以下症状：成熟的果实被成虫咬食后会出现小孔，一两天后，该部位会出现圆形斑点，呈黑色，斑中还有果汁流出；则该虫害为吸果夜蛾。
4.3.4.4 树枝虫害
叶片虫害决策规则共2条，分别如下：
规则1：如果符合以下症状：①枝干被木蠹蛾幼虫吸食成坑道，该虫害食害枝干硬皮部，在树干外面通过虫丝缀连接虫粪与枝干皮屑的形式产生隧道；②白天幼虫会藏在坑道里，夜里会沿隧道爬行吃树皮，减弱树的长势，使荔枝产量降低；病情严重时，可使幼树枯萎至死；则该虫害为木蠹蛾。
规则2：如果符合以下症状：①树干受到星天牛幼虫的危害，导致水分和养分的传输受到影响；②整个植株会变黄，有些叶片会掉落，树生长的速度变慢，多数果树的树干受到这种虫的危害；则该虫害为天牛。
4.3.4.5 叶片果实综合虫害
叶片虫害决策规则共3条，分别如下：
规则1：如果符合以下症状：①叶片受到幼虫的危害出现孔洞；②成熟果实被成虫的虹吸式口器吸食汁液，会造成大部分果实腐烂和脱落；则该虫害为鸟嘴壶夜蛾。
规则2：如果符合以下症状：①花、叶片和果实等植株幼嫩组织被蓟马成虫和若虫锉吸其汁液；②被害的嫩叶和树枝变得僵化卷曲枯萎，叶的表面出现浓密的小斑点，呈白色，植株长势减弱；③被害幼嫩果实将变硬，甚至造成果实脱落；该虫害为蓟马。
规则3：如果符合以下症状：荔枝嫩梢、树叶和果实的表面被成虫刺吸汁液，使树叶变得枯萎，导致树叶和果实都脱落；则该虫害为红蜘蛛。
4.3.4.6 叶片树枝综合虫害
叶片虫害决策规则共2条，分别如下：
规则1：如果符合以下症状：①幼虫通过吸食树干造成危害和孔道；②成虫咬食鲜嫩的树叶、树枝和果实，导致果实腐烂；则该虫害为荔枝独角仙。
规则2：如果符合以下症状：①苗木是被害部位之一，菟丝子盘缠树枝导致缢痕丛生，树枝长势缓慢，苗木质量较差，病情较重者会枯萎而死；②果园植株受害，菟丝子的迅速繁殖导致树冠被覆盖，枝叶的生长受到影响，导致叶片枯萎和掉落，树的生长缓慢，严重整棵树株枯萎而死；则该虫害为荔枝菟丝子。
4.4 总体架构
专家决策系统包括 6个模块，分别为荔枝园基础设置、实时监控与报警、灌溉预测与决策、专家知识、专家建议与答疑和后台管理，具体结构如图4.2所示。


图4.2  专家决策系统结构图
4.5 功能模块设计
4.5.1 基础设置
用户通过此模块中的添加荔枝园资料、添加气象资料、添加土壤特性和添加作物生长信息，为专家系统决策提供辅助事实数据。
4.5.1.1 添加荔枝园资料
用户分别输入荔枝园名称、省份、城市、气候带等信息，点击“提交”按钮，专家系统将这些基本资料保存综合数据库的荔枝园基础信息表中，其页面如图4.3所示。


图4.3  添加荔枝园资料页面

4.5.1.2 添加气象资料
用户分别输入计算时段内最高气温、计算时段内最低气温、计算时段内2m出平均风速、计算时段内平均气温等信息，点击“提交”按钮，专家系统将这些资料保存到综合数据库的荔枝园气象信息表中，添加气象资料页面如图4.4所示。


图4.4  添加气象资料页面
4.5.1.3 添加土壤特性
用户分别输入荔枝品种、荔枝所处生育期、土壤质地类别、地下水埋深和土壤干容量等信息，点击“提交”按钮，专家系统将这些资料保存到综合数据库的荔枝园土壤特性表中，添加土壤特性资料页面如图4.5所示。


图4.5  添加土壤特性页面

4.5.1.4 添加作物生长信息
用户分别输入荔枝品种、荔枝所处生育期、该品种荔枝根系活动层深度等信息，点击“提交”按钮，专家系统将这些资料保存到综合数据库的荔枝信息表中，添加作物生长信息页面如图4.6所示。


图4.6  添加作物生长信息页面

4.5.2 实时监控与报警
该模块该模块表格形式显示荔枝园实时环境信息，该模块每隔1小时从综合数据库中的荔枝园实时监测表中读取模块号、监测数据接收时间、数据包号、温度、湿度、光照度、土壤含水率、电池电压和电磁阀状态等信息，并将最新数据填充在界面的表格中。当土壤含水率超过设定阈值时，专家系统会自动发送报警短信到预存在系统中的手机号码上。实时监控与报警界面图4.7所示。


图4.7 实时监控与报警界面

4.5.3 灌溉预测与决策
此模块是专家系统中比较重要的部分，包括计算需水量、灌溉预测、灌溉决策和施肥决策，智能化辅助用户管理荔枝园。
4.5.3.1 计算需水量
（1）彭曼公式说明：此页面包含Penman-Monteith公式说明、各参数意义和计算以及需水量公式说明三个部分，其中，需水量公式说明如图4.8所示。


图4.8 需水量公式说明页面

（2）计算参考作物蒸腾量：
用户选择荔枝园名称、年份和月份，输入纬度、海拔、该月某次降雨总量、计算时段内最高气温等信息，点击“计算ET0”按钮，即可得出参考作物蒸腾量ET0，其界面如图4.9所示。


图4.9 计算参考作物蒸腾量页面

（3）计算需水量：用户选择荔枝园名称、荔枝品种、荔枝生长周期、年份和月份，输入Kc值等信息，点击“计算需水量”，可计算需水量，其界面如图4.10所示。


图4.10 计算需水量页面

4.5.3.2 灌溉预测
（1）水平衡方程说明：
此页面包含水平衡公式说明、简化的水平衡公式和灌溉时间间隔说明三个部分，其中，水平衡公式说明如图4.11所示。
（2）灌溉时间间隔：
用户选择土壤特性，输入作物蒸发蒸腾量Etc、地下水补给量Ge等信息，点击“计算灌溉时间间隔”按钮，即可计算灌溉时间间隔，其界面如图4.12所示。


图4.11 水平衡公式说明页面


图4.12 计算灌溉时间间隔页面

4.5.3.3 灌溉决策
（1）灌溉制度决策：用户选择选择荔枝园，荔枝品种、荔枝所处生育期等信息，点击“根据灌溉制度决策”，可计算出灌水定额，灌溉制度决策界面如图4.13所示。


图4.13 根据灌溉制度决策页面
（2）灌溉定量决策：用户选择荔枝园、荔枝品种和相应的生育期，输入计算需水量的土壤深度、田间持水量等信息，点击“根据灌溉量”按钮，即可计算出灌溉量，灌溉定量决策界面如图4.14所示。


图4.14 灌溉定量决策页面

（3）智能灌溉决策：用户选择选择荔枝园，荔枝品种、荔枝所处生育期等信息，点击“智能灌溉决策”按钮，即可得出出干旱指数和决策结果说明，智能灌溉决策界面如图4.15所示。


图4.15 智能灌溉决策页面

4.5.3.4 施肥决策
（1）一般施肥方案决策：用户选择荔枝的树龄信息，点击“进行决策”按钮，即可得到决策报告，一般施肥方案决策界面如图4.16所示。


图4.16 一般施肥决策页面

（2）目标产量施肥决策：用户选择荔枝的树龄信息，输入目标产量，点击“进行决策”按钮，即可得到决策报告，目标产量施肥决策界面如图4.17所示。


图4.17 目标产量施肥决策页面

4.6.4 专家知识
用户可以通过该模块获知荔枝病、虫害的相关知识，根据相关的症状诊断诊断出对应的荔枝病、虫害，并得知应该如何采取相应的防治措施；该模块可以实时获取专家们由人机交互界面输入的荔枝种植和病、虫害防治方面等相关知识，知识获取模块会将这些专家知识存储或更新到数据库里，体现出该专家系统能不断更新知识库。
4.5.4.1 荔枝种植知识
（1）添加种植知识：用户输入荔枝品种、荔枝所处生育期、标题和详细内容后，点击“确定添加”按钮，即可添加荔枝种植知识，其界面如图4.18所示。


图4.18 添加荔枝种植知识页面

（2）查看种植知识：用户可以查看荔枝种植知识列表，点击相应的“查看”按钮，即查看相应标题所对应的详细内容，其界面如图4.19所示。


图4.19 查看荔枝种植知识页面

4.5.4.2 病虫害知识
（1）添加病虫害知识：用户输入病虫害标题和关于该病害或虫害的详细内容后，点击“确定添加”按钮，即可添加病虫害知识，其界面如图4.20所示。
（2）查看病虫害知识：用户可以查看病虫害知识列表，点击相应的“查看”按钮，即查看相应标题所对应的详细内容，其界面如图4.21所示。


图4.20 添加病虫害知识页面


图4.21 查看病虫害知识页面

4.5.4.3 诊断荔枝病害
用户勾选荔枝病害特征选项，点击“荔枝病害诊断”按钮，专家系统将用户选择的荔枝病害特征与知识库中荔枝病害决策规则表中的病害特征一一比较，如果完全匹配某病害所对应的所有病害特征，则输出该荔枝病害名称，其界面如图4.22所示：


图4.22 荔枝病害诊断页面

4.5.4.4 诊断荔枝虫害
用户勾选荔枝虫害特征选项，点击“荔枝虫害诊断”按钮，专家系统将用户选择的荔枝病害特征与知识库中荔枝虫害决策规则表中的虫害特征一一比较，如果完全匹配某虫害所对应的所有虫害特征，则输出该荔枝虫害名称，其界面如图4.23所示：


图4.23 荔枝虫害诊断页面

4.5.5 专家建议与答疑
专家决策系统一个比较重要的功能是，普通用户对专家系统得出的结论或者建议不满意时，可以通过在线上传自己的问题和图片的途径去咨询专家；专家通过普通用户问题列表可以看到每个问题的回答状态和回答数，然后回答自己擅长的问题。这种方式使专家系统在知识库不够完备的情况下，依然能给用户提供有效地帮助和指导。
4.5.5.1 用户问题专区
（1）提出问题：用户输入标题和详细内容，在详细内容的输入框中还可以上传图片，点击相应的“确定提问”按钮，即可提出问题，其界面如图4.24所示。


图4.24 提出问题页面
（2）查看解答：查看解答表格列出了用户问题标题、提问时间、用户名、用户类型、回答状态和回答数，用户通过点击相应的“查看”按钮，即查看该问题对应的专家解答，其界面如图4.25所示。


图4.25 提查看解答页面

4.5.5.2 专家答疑专区
解答问题：解答问题表格列出了问题标题、提问时间、用户名、用户类型、回答状态和回答数，专家通过点击相应的“回答”，可回答该问题，其界面如图4.26所示。


图4.26 解答问题页面

4.5.6 后台管理
此模块包含综合数据库管理、知识库管理、账号管理等功能，管理形式为更新、插入和删除等。普通用户只能修改本身的账号资料，而专家能修改部分知识库内容。
4.5.6.1 专家知识管理
（1）荔枝种植知识管理：用户通过查看荔枝种植知识管理列表，点击相应的“编辑”按钮，即可编辑该项种植知识，其界面如图4.27所示。
（2）荔枝病虫害管理：用户通过查看荔枝病虫害管理列表，点击相应的“编辑”按钮，即可编辑该项病虫害知识，其界面如图4.28所示。


图4.27 荔枝种植知识管理页面


图4.28 荔枝病虫害知识管理页面

4.5.6.2 账号管理
（1）修改密码：用户输入原密码、新密码和确认新密码，点击相应的“确定”按钮，即可修改密码，修改密码界面如图4.29所示。


图4.29 修改密码页面

（2）添加新用户：用户输入新用户名、密码和再次输入密码，点击相应的“确定”按钮，即可添加新用户，添加新用户界面如图4.30所示。


图4.30 添加新用户页面

（3）删除用户：用户通过查看用户列表，点击相应的“删除”按钮，即可相应的用户，删除用户界面如图4.31所示。


图4.31 删除用户页面

4.6 本章小结
本章首先设计了专家决策系统的数据库，包括综合数据库和知识库，数据库能存储海量的专家知识和系统决策所需的数据；接着为专家决策系统归纳出一般施肥方案、目标产量施肥方案、荔枝病害诊断和荔枝虫害诊断等规则；然后对专家系统进行总体规划，包括功能需求和模块组成；最后通过软件编程实现专家系统的各个功能模块，为接下来的系统试验做好了充分的准备。
















第5章 系统试验
5.1 引言
上文中，第3章和第4章分别进行了荔枝园信息获取部分软硬件设计和专家决策系统的设计和实现，为本章的系统试验部分提供了硬件基础和软件平台。
5.2 荔枝园总体环境
本文设计和实现基于物联网的荔枝园信息获取与专家决策系统，并从2015年4月7号到4月24号在龙翔荔枝园实地进行了系统整合和试验，来分析该系统的工作性能。该荔枝园的位置为广东省阳江市阳西县新圩镇，其地理信息图如图5.1所示。该荔枝园实际环境为：长约260m，宽约150m，面积共60余亩，种植荔枝树多达1500余棵，每棵树高2到3m，每棵树的间隔为 5m，每排树相隔为4m，荔枝品种为糯米糍，正处于果实发育生长期。荔枝园现场环境图如图5.2所示。


图5.1  荔枝园地理信息图

5.3 终端监控设备有效通信距离测试
为了系统试验中能更加合理地在荔枝园里部署终端监控设备，必须对终端监控设备有效通信距离测试。分别在荔枝园和空旷地带测量终端监控设备的有效通信距离，


图5.2  现场场景图

以求得其最大通信距离。将终端监控设备高度依次设置为0.25、0.5、0.75、1.0、1.25
和1.5m，设定射频频率为2.4 GHz频段，发射功率设置为Zigbee模块的最大值21 dBm。测试方案为：定时地（每隔10 s）向网关模块发送终端监控设备监测的荔枝园环境信息，网关模块通过串口将数据发送到电脑端的串口助手上，试验人员在串口助手上查看能否接收到数据，如果能，则增加设备间的距离。当网关模块接收数据变得不稳定时，通过激光测距仪测量两终端监控设备之间的直线距离，为了使测量精度尽可能地高，对此距离反复测量10次后求平均值。测试数据如表5.1所示，结果表明，当终端监控设备高度为1.0 m时，信号传输距离达到最远。

表5.1  终端监控设备最大通信有效距离

5.4 系统试验方案
系统试验中，信息采集终端模块、终端控制模块和网关模块部署的合理性直接决定着网络性能的好坏。在部署各个模块的过程中，如果放置过多的采集终端模块，会造成信息量过多，增加系统的信道负担和成本；相反，如果采集终端模块的位置和数量不能覆盖整个网络，则会降低系统的实时性，使系统采集的环境信息不完整（刘卉，等，2011）。


图5.3  现场测试网络示意图

系统试验的网络示意图如图5.3所示。试验方案为：在§5.3的测试中，当终端监控设备高度为1.0 m时，测得其在荔枝园中的最大有效通信距离为81.5m，为了使系统能完全监测整个荔枝园，试验中将荔枝园划分为9个区域，网关模块负责将来自各个监控区域的信息采集终端模块监测的环境数据包通过GRPS网发送到远程服务器模块以及接收来自远程服务器模块的命令数据包，然后通过Zigbee网发送到信息采集终端模块上，所以网关模块不必休眠，而且放置在屋子里，以保证长期供电；信息采集终端模块1到信息采集终端模块4和信息采集终端模块6到信息采集终端模块8，依次设置在距离网关模块直线距离不超过80m的区域上，这些信息采集终端模块的环境数据包不需要经过路由模块就可以发送到网关模块上；由于信息采集终端模块5和信息采集终端模块9距离网关模块的直线距离已经超过81.5m，需要在传输通道上加入路由模块，路由模块距离信息采集终端模块5或信息采集终端模块9的直线距离约为80m，距离网关模块的直线距离也约为80m，因此信息采集终端模块5和信息采集终端模块9监测的环境数据包经过路由模块的转发，就可以发送到网关模块上。每片灌溉区域均有相应的信息采集终端模块定时地监测该区域的空气温度、空气湿度、土壤含水率和光照度环境信息，为专家系统的决策提供数据支持；同时，每片灌溉区域均放置一个控制终端模块，各区域的水管开关连接着一个电磁阀，控制终端模块接收来自专家系统的命令包以控制电磁阀开启或关闭，实现智能灌溉。
信息采集终端模块和终端控制模块工作图如图5.4所示。

      
a. 信息采集终端模块         b. 终端控制模块
图5.4  信息采集终端模块和终端控制模块工作图

5.5 网络丢包率试验
系统通信的稳定性是对于系统的正常运行有着十分重要的意义，信息采集终端模块在连续15d里，每隔30分钟采集一次环境数据，其测试结果如表5.2所示，其中，每个信息采集终端模块的丢包率的计算如式（5.2）所示。
                          （5.2）
其中，S为信息采集终端模块发送数据包总数，R为网关模块接收到的数据包总数，由表5.2可得，单个信息采集终端模块的最低丢包率为2.63%，最高丢包率为4.03%，因此，所有信息采集终端模块丢包率都比较低，使得系统能正常通信。
整个网络的平均丢包率的计算如式（5.3）所示。
                      （5.3）
其中，分子部分为各个信息采集终端模块丢包总数，分母部分为各个信息采集终端模块发送数据包总数。试验中，系统具有9个信息采集终端模块，故p取为1，m取为9。测试结果如表5.2所示，由式5.3得，整个系统的平均丢包率仅为3.41%，说明系统能稳定运行，信号传输可靠。

表5.2  网络丢包率统计

5.6 信息采集终端模块监测精度测试
信息采集终端模块能实时监测荔枝园环境信息，为专家系统智能决策提供了数据支持，因此这些环境信息的准确性对专家系统的稳定性有着十分重要的影响（余国雄，等，2016）。试验中，利用台湾泰仕TES-1317电阻温度计（-50~199.9℃，精度为±1℃）、华盛昌DT-8896干湿球湿度计（相对湿度精度±2%）、希玛AR813A光照度测量仪（精度±0.5%FS）和绩泰FD-T土壤水分测定仪（精度±0.5%）等4款高精度测试仪器在信息采集终端模块处测量温度、湿度、光照度和土壤含水率，分别与信息采集终端模块通过DHT22、BY-30和TDR-3传感器得到的实测值进行对比。通过2015年4月7日8:00开始进行的12小时的湿度、温度实测对比，试验期间各项指标数据如表5.3所示。

表5.3  各项指标数据

从2015年4月7日8:00-20:00，信息采集终端模块温度监测值和电阻温度计实测值的对比如图5.5所示。
由图5.5可知，监测值和实测值的最大误差为0.5℃，最小误差为0.1℃。由此可知信息采集终端模块的监测精度较高，能向专家系统的决策提供较为准确地数据支持。